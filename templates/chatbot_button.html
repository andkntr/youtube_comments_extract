{% extends "base.html" %}

{% block title %}階層型チャットボット{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mb-4">階層型チャットボット</h1>
    <div class="card shadow-sm">
        <div class="card-body">
            <p class="card-text">以下のボタンをクリックして、チャットボットと対話してください。</p>
            <!-- メイン質問 -->
            <div id="main-questions" class="d-flex flex-wrap justify-content-center my-3">
                {% for question in questions %}
                <button class="btn btn-primary m-2" onclick="showSubQuestions('{{ question }}')">{{ question }}</button>
                {% endfor %}
            </div>

            <!-- サブ質問 -->
            <div id="sub-questions" class="d-flex flex-wrap justify-content-center my-3" style="display: none;"></div>

            <!-- 応答 -->
            <div id="response" class="alert alert-secondary mt-4" role="alert" style="display: none;">
                ボットの応答がここに表示されます。
            </div>
        </div>
    </div>
</div>

<script>
    // サブ質問を表示
    async function showSubQuestions(mainQuestion) {
        const response = await fetch("/chatbot_button/get_sub_questions", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ main_question: mainQuestion })
        });
        const data = await response.json();

        const subQuestionsDiv = document.getElementById("sub-questions");
        subQuestionsDiv.innerHTML = ""; // サブ質問をリセット
        data.sub_questions.forEach(subQuestion => {
            const button = document.createElement("button");
            button.className = "btn btn-secondary m-2";
            button.innerText = subQuestion;
            button.onclick = () => sendInput(mainQuestion, subQuestion);
            subQuestionsDiv.appendChild(button);
        });

        // サブ質問セクションを表示
        subQuestionsDiv.style.display = "flex";
    }

    // 応答を表示
    async function sendInput(mainQuestion, subQuestion) {
        const responseDiv = document.getElementById("response");
        responseDiv.style.display = "block";
        responseDiv.textContent = "考え中...";

        const response = await fetch("/chatbot_button/get_response", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ main_question: mainQuestion, sub_question: subQuestion })
        });
        const data = await response.json();
        responseDiv.textContent = data.response;
    }
</script>
{% endblock %}
